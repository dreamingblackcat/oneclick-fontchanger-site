// Generated by CoffeeScript 1.6.3
(function() {
  var DB;

  DB = (function() {
    function DB(db_url) {
      var _this = this;
      this.db_url = db_url;
      this.getCount(function(result) {
        return console.log(result);
      }, function(err) {
        return _this.setCount();
      });
    }

    DB.prototype.setCount = function() {
      return pg.connect(this.db_url, function(err, client, done) {
        client.query("CREATE TABLE count (id int PRIMARY KEY,hits int);", function(err, result) {
          if (err) {
            return console.error(err);
          }
        });
        return client.query("INSERT INTO count VALUES (1,0)", function(err, result) {
          done();
          if (err) {
            return console.error(err);
          }
        });
      });
    };

    DB.prototype.getCount = function(success, error) {
      return pg.connect(this.db_url, function(err, client, done) {
        done();
        if (err) {
          console.error(err);
        }
        return client.query("SELECT * FROM count WHERE id=1;", function(err, result) {
          console.log(result);
          if (err) {
            console.error(err);
            return error();
          } else {
            return success(result);
          }
        });
      });
    };

    DB.prototype.updateCount = function(new_count) {
      return pg.connect(this.db_url, function(err, client, done) {
        if (err) {
          console.error(err);
        }
        client.query("UPDATE count SET VALUES(" + new_count + " WHERE id=1;");
        return done();
      });
    };

    return DB;

  })();

}).call(this);
